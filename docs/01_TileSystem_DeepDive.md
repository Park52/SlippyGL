# ğŸ—ºï¸ SlippyGL íƒ€ì¼ ì‹œìŠ¤í…œ ë”¥ë‹¤ì´ë¸Œ

> **í•™ìŠµ ëª©í‘œ**: ë©€í‹° íƒ€ì¼ ë Œë”ë§ ì‹œìŠ¤í…œì˜ ëª¨ë“  êµ¬ì„± ìš”ì†Œë¥¼ ì™„ì „íˆ ì´í•´í•˜ê¸°
> 
> **ì˜ˆìƒ í•™ìŠµ ì‹œê°„**: ì´ 2-3ì‹œê°„ (ì„¹ì…˜ë³„ë¡œ ë‚˜ëˆ ì„œ ì½ê¸° ê°€ëŠ¥)
> 
> **ë‚œì´ë„**: â­â­â­ (ì¤‘ê¸‰ ~ ê³ ê¸‰)

---

## ğŸ“š ëª©ì°¨

1. [ê°œìš”: ì›¹ ì§€ë„ íƒ€ì¼ ì‹œìŠ¤í…œ](#1-ê°œìš”-ì›¹-ì§€ë„-íƒ€ì¼-ì‹œìŠ¤í…œ)
2. [TileKey: íƒ€ì¼ ì¢Œí‘œê³„ì˜ í•µì‹¬](#2-tilekey-íƒ€ì¼-ì¢Œí‘œê³„ì˜-í•µì‹¬)
3. [TileGrid: ë·°í¬íŠ¸ ì ˆë‘ì²´ ì»¬ë§](#3-tilegrid-ë·°í¬íŠ¸-ì ˆë‘ì²´-ì»¬ë§)
4. [TileCache: LRU ìºì‹œ ì•Œê³ ë¦¬ì¦˜](#4-tilecache-lru-ìºì‹œ-ì•Œê³ ë¦¬ì¦˜)
5. [TileRenderer: íŒŒì´í”„ë¼ì¸ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜](#5-tilerenderer-íŒŒì´í”„ë¼ì¸-ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜)
6. [Camera2D: ë³€í™˜ í–‰ë ¬ê³¼ ì¢Œí‘œ ë³€í™˜](#6-camera2d-ë³€í™˜-í–‰ë ¬ê³¼-ì¢Œí‘œ-ë³€í™˜)
7. [ì „ì²´ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨](#7-ì „ì²´-ì‹œí€€ìŠ¤-ë‹¤ì´ì–´ê·¸ë¨)
8. [ì—°ìŠµ ë¬¸ì œ](#8-ì—°ìŠµ-ë¬¸ì œ)

---

# 1. ê°œìš”: ì›¹ ì§€ë„ íƒ€ì¼ ì‹œìŠ¤í…œ

## ğŸ“– ì½ê¸° ì‹œê°„: 10ë¶„

### 1.1 ìŠ¬ë¦¬í”¼ ë§µ(Slippy Map)ì´ë€?

**Slippy Map**ì€ Google Maps, OpenStreetMap ë“±ì—ì„œ ì‚¬ìš©í•˜ëŠ” íƒ€ì¼ ê¸°ë°˜ ì§€ë„ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

```
ì „ ì„¸ê³„ ì§€ë„ë¥¼ 256Ã—256 í”½ì…€ì˜ ì‘ì€ íƒ€ì¼ë¡œ ë¶„í• 
    â†“
ì¤Œ ë ˆë²¨ë§ˆë‹¤ ë‹¤ë¥¸ í•´ìƒë„ì˜ íƒ€ì¼ ì œê³µ
    â†“
í•„ìš”í•œ íƒ€ì¼ë§Œ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ë©”ëª¨ë¦¬ ì ˆì•½
```

### 1.2 ì¤Œ ë ˆë²¨ê³¼ íƒ€ì¼ ìˆ˜

| ì¤Œ ë ˆë²¨ | íƒ€ì¼ ìˆ˜ (ê°€ë¡œÃ—ì„¸ë¡œ) | ì´ íƒ€ì¼ ìˆ˜ | ìš©ë„ |
|--------|-------------------|-----------|------|
| 0 | 1Ã—1 | 1 | ì „ ì„¸ê³„ í•œ ì¥ |
| 1 | 2Ã—2 | 4 | ëŒ€ë¥™ |
| 5 | 32Ã—32 | 1,024 | êµ­ê°€ |
| 10 | 1024Ã—1024 | 1,048,576 | ë„ì‹œ |
| 12 | 4096Ã—4096 | 16,777,216 | êµ¬/ë™ (ì„œìš¸ì‹œì²­ ìœ„ì¹˜) |
| 18 | 262144Â² | 68ì–µ | ê±´ë¬¼ ìˆ˜ì¤€ |

### 1.3 í•µì‹¬ ê³µì‹

```
íƒ€ì¼ ìˆ˜ = 2^z Ã— 2^z = 4^z

ì˜ˆ: z=12ì¼ ë•Œ
- ê°€ë¡œ íƒ€ì¼ ìˆ˜: 2^12 = 4096ê°œ
- ì´ íƒ€ì¼ ìˆ˜: 4096 Ã— 4096 = 16,777,216ê°œ
```

### 1.4 ì™œ íƒ€ì¼ ì‹œìŠ¤í…œì¸ê°€?

**ë¬¸ì œ**: ì „ ì„¸ê³„ ì§€ë„ë¥¼ í•œ ì´ë¯¸ì§€ë¡œ ë§Œë“¤ë©´?
```
ì¤Œ 18 ê¸°ì¤€: 262144 Ã— 262144 í”½ì…€ = 68.7 ê¸°ê°€í”½ì…€
ìš©ëŸ‰: 68.7 Ã— 10^9 Ã— 4ë°”ì´íŠ¸(RGBA) = 274GB ğŸ˜±
```

**í•´ê²°**: íƒ€ì¼ë¡œ ë¶„í• 
```
í™”ë©´ì— ë³´ì´ëŠ” ì˜ì—­: ~10ê°œ íƒ€ì¼
10 Ã— 256 Ã— 256 Ã— 4 = 2.5MB ğŸ‘
```

### ğŸ’¡ í•µì‹¬ ì¸ì‚¬ì´íŠ¸

> **"í•„ìš”í•œ ê²ƒë§Œ, í•„ìš”í•  ë•Œ, í•„ìš”í•œ ë§Œí¼"**
> 
> ì´ ì›ì¹™ì´ íƒ€ì¼ ì‹œìŠ¤í…œì˜ í•µì‹¬ì´ë©°, 
> ê·¸ë˜í”½ìŠ¤ í”„ë¡œê·¸ë˜ë°ì˜ ê°€ì¥ ì¤‘ìš”í•œ ìµœì í™” ì² í•™ì…ë‹ˆë‹¤.

---

# 2. TileKey: íƒ€ì¼ ì¢Œí‘œê³„ì˜ í•µì‹¬

## ğŸ“– ì½ê¸° ì‹œê°„: 15ë¶„

### 2.1 TileKey êµ¬ì¡°ì²´

```cpp
// src/tile/TileKey.hpp

struct TileKey {
    int z = 0;  // ì¤Œ ë ˆë²¨ (0-22)
    int x = 0;  // X ì¸ë±ìŠ¤ (0 to 2^z - 1)
    int y = 0;  // Y ì¸ë±ìŠ¤ (0 to 2^z - 1)
    
    // ìƒì„±ì
    TileKey(int z_, int x_, int y_) : z(z_), x(x_), y(y_) {}
};
```

### 2.2 C++ ë¬¸ë²• í•´ì„¤

#### 2.2.1 ë©¤ë²„ ì´ˆê¸°í™” ë¦¬ìŠ¤íŠ¸ (Member Initializer List)

```cpp
TileKey(int z_, int x_, int y_) : z(z_), x(x_), y(y_) {}
//                               â†‘ ì½œë¡  ë’¤ê°€ ì´ˆê¸°í™” ë¦¬ìŠ¤íŠ¸
```

**ì™œ `z = z_` ëŒ€ì‹  `: z(z_)`ë¥¼ ì‚¬ìš©í•˜ëŠ”ê°€?**

```cpp
// ë°©ë²• 1: ëŒ€ì… (ëŠë¦¼)
TileKey(int z_, int x_, int y_) {
    z = z_;  // ê¸°ë³¸ ì´ˆê¸°í™” í›„ ëŒ€ì… â†’ 2ë‹¨ê³„
}

// ë°©ë²• 2: ì´ˆê¸°í™” ë¦¬ìŠ¤íŠ¸ (ë¹ ë¦„)
TileKey(int z_, int x_, int y_) : z(z_) {}
// ì§ì ‘ ì´ˆê¸°í™” â†’ 1ë‹¨ê³„
```

**ì„±ëŠ¥ ì°¨ì´**: ê¸°ë³¸ íƒ€ì…(int)ì€ ë¯¸ë¯¸í•˜ì§€ë§Œ, ë³µì¡í•œ ê°ì²´ëŠ” í° ì°¨ì´!

#### 2.2.2 noexcept ì§€ì •ì

```cpp
bool operator==(const TileKey& other) const noexcept {
    return z == other.z && x == other.x && y == other.y;
}
```

**`noexcept`ì˜ ì˜ë¯¸:**
- ì´ í•¨ìˆ˜ëŠ” ì˜ˆì™¸ë¥¼ ë˜ì§€ì§€ ì•ŠìŒì„ ì»´íŒŒì¼ëŸ¬ì—ê²Œ ì•Œë¦¼
- ì»´íŒŒì¼ëŸ¬ê°€ ë” ê³µê²©ì ì¸ ìµœì í™” ê°€ëŠ¥
- STL ì»¨í…Œì´ë„ˆê°€ move ì—°ì‚° ì‹œ ì´ ì •ë³´ í™œìš©

**ê·œì¹™**: ê°„ë‹¨í•œ ì—°ì‚°, ë©”ëª¨ë¦¬ í• ë‹¹ ì—†ìŒ â†’ `noexcept` ë¶™ì´ê¸°

### 2.3 í•´ì‹œ í•¨ìˆ˜ êµ¬í˜„

```cpp
namespace std {
    template<>
    struct hash<slippygl::tile::TileKey> {
        size_t operator()(const TileKey& key) const noexcept {
            size_t h = static_cast<size_t>(key.z);
            h = h * 31 + static_cast<size_t>(key.x);
            h = h * 31 + static_cast<size_t>(key.y);
            return h;
        }
    };
}
```

#### 2.3.1 ì™œ í•´ì‹œê°€ í•„ìš”í•œê°€?

```cpp
std::unordered_map<TileKey, Texture> cache;
cache[TileKey(12, 3554, 1609)] = myTexture;  // O(1) ì¡°íšŒ!
```

`unordered_map`ì€ í•´ì‹œ í…Œì´ë¸” â†’ í‚¤ë¥¼ ì •ìˆ˜ë¡œ ë³€í™˜í•´ì•¼ í•¨

#### 2.3.2 í•´ì‹œ ì•Œê³ ë¦¬ì¦˜ ë¶„ì„

```cpp
h = h * 31 + key.x;
```

**ì™œ 31ì¸ê°€?**
- 31ì€ ì†Œìˆ˜(prime number)
- ì†Œìˆ˜ë¥¼ ê³±í•˜ë©´ í•´ì‹œ ì¶©ëŒì´ ì ìŒ
- `31 = 32 - 1 = 2^5 - 1` â†’ ë¹„íŠ¸ ì—°ì‚°ìœ¼ë¡œ ìµœì í™” ê°€ëŠ¥
  - `x * 31 = (x << 5) - x`

**í•´ì‹œ ì¶©ëŒ ì˜ˆì‹œ:**
```
TileKey(12, 100, 200)ì˜ í•´ì‹œ:
  h = 12
  h = 12 * 31 + 100 = 472
  h = 472 * 31 + 200 = 14,832

TileKey(12, 101, 169)ì˜ í•´ì‹œ:
  h = 12 * 31 + 101 = 473
  h = 473 * 31 + 169 = 14,832  â† ì¶©ëŒ! (ê°™ì€ í•´ì‹œ)
```

ì¶©ëŒì´ ë°œìƒí•˜ë©´ `unordered_map`ì´ ì²´ì´ë‹/í”„ë¡œë¹™ìœ¼ë¡œ í•´ê²°

### 2.4 ì¢Œí‘œ ë³€í™˜ ìœ í‹¸ë¦¬í‹°

```cpp
namespace TileCoord {
    // ì›”ë“œ í”½ì…€ â†’ íƒ€ì¼ ì¸ë±ìŠ¤
    inline int worldPxToTileIndex(float worldPx, int tileSizePx = 256) {
        return static_cast<int>(std::floor(worldPx / static_cast<float>(tileSizePx)));
    }
    
    // íƒ€ì¼ ì¸ë±ìŠ¤ â†’ ì›”ë“œ í”½ì…€
    inline float tileIndexToWorldPx(int tileIndex, int tileSizePx = 256) {
        return static_cast<float>(tileIndex * tileSizePx);
    }
}
```

#### 2.4.1 `std::floor` vs ë‹¨ìˆœ ë‚˜ëˆ—ì…ˆ

```cpp
// ì˜ëª»ëœ ë°©ë²• (ìŒìˆ˜ì—ì„œ ì˜¤ë¥˜)
int idx = (int)(worldPx / 256);  
// worldPx = -100 â†’ -0.39 â†’ 0 (ì˜ëª»!)

// ì˜¬ë°”ë¥¸ ë°©ë²•
int idx = std::floor(worldPx / 256);
// worldPx = -100 â†’ -0.39 â†’ -1 (ì˜¬ë°”ë¦„!)
```

**ê·¸ë¦¼ìœ¼ë¡œ ì´í•´:**
```
íƒ€ì¼ ì¸ë±ìŠ¤:  -1       0       1       2
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”
í”½ì…€:     -256    0     256    512    768
              â†‘
           -100ì€ -1ë²ˆ íƒ€ì¼ì— ì†í•¨
```

#### 2.4.2 inline í‚¤ì›Œë“œ

```cpp
inline int worldPxToTileIndex(float worldPx) { ... }
```

**ì¸ë¼ì¸ í•¨ìˆ˜ë€?**
- í•¨ìˆ˜ í˜¸ì¶œ ëŒ€ì‹  ì½”ë“œë¥¼ í˜¸ì¶œ ìœ„ì¹˜ì— ì§ì ‘ ì‚½ì…
- í•¨ìˆ˜ í˜¸ì¶œ ì˜¤ë²„í—¤ë“œ ì œê±° (ìŠ¤íƒ í‘¸ì‹œ/íŒ, ì í”„)
- ì‘ì€ í•¨ìˆ˜ì— ì í•©

**ì£¼ì˜**: í˜„ëŒ€ ì»´íŒŒì¼ëŸ¬ëŠ” `inline` íŒíŠ¸ ì—†ì´ë„ ìë™ ì¸ë¼ì¸í™”

### 2.5 ìˆ˜í•™: íƒ€ì¼ ì¢Œí‘œê³„

#### 2.5.1 ì›”ë“œ ì¢Œí‘œ â†’ íƒ€ì¼ ì¸ë±ìŠ¤

```
tileX = floor(worldPixelX / 256)
tileY = floor(worldPixelY / 256)

ì˜ˆ: worldPixel = (900, 450)
    tileX = floor(900 / 256) = floor(3.51) = 3
    tileY = floor(450 / 256) = floor(1.76) = 1
    â†’ TileKey(z, 3, 1)
```

#### 2.5.2 íƒ€ì¼ ì¸ë±ìŠ¤ â†’ ì›”ë“œ ì¢Œí‘œ (ì¢Œìƒë‹¨)

```
worldPixelX = tileX Ã— 256
worldPixelY = tileY Ã— 256

ì˜ˆ: TileKey(z, 3, 1)
    worldPixelX = 3 Ã— 256 = 768
    worldPixelY = 1 Ã— 256 = 256
    â†’ ì¢Œìƒë‹¨ (768, 256)
```

### ğŸ“ í•µì‹¬ ì •ë¦¬

| ê°œë… | ì„¤ëª… | C++ í‚¤ì›Œë“œ |
|-----|------|-----------|
| TileKey | z/x/yë¡œ íƒ€ì¼ ì‹ë³„ | struct |
| í•´ì‹œ í•¨ìˆ˜ | unordered_map ì‚¬ìš© ìœ„í•´ í•„ìš” | std::hash íŠ¹ìˆ˜í™” |
| ì¢Œí‘œ ë³€í™˜ | ì›”ë“œ í”½ì…€ â†” íƒ€ì¼ ì¸ë±ìŠ¤ | inline, std::floor |

---

# 3. TileGrid: ë·°í¬íŠ¸ ì ˆë‘ì²´ ì»¬ë§

## ğŸ“– ì½ê¸° ì‹œê°„: 15ë¶„

### 3.1 ë¬¸ì œ ì •ì˜

```
ì¤Œ 12ì—ì„œ ì „ì²´ íƒ€ì¼: 16,777,216ê°œ
í™”ë©´ì— ë³´ì´ëŠ” íƒ€ì¼: ~10ê°œ

ì§ˆë¬¸: ì–´ë–¤ 10ê°œë¥¼ ê·¸ë¦´ì§€ ì–´ë–»ê²Œ ì•Œ ìˆ˜ ìˆë‚˜?
```

### 3.2 ì ˆë‘ì²´ ì»¬ë§(Frustum Culling)ì´ë€?

**ì •ì˜**: ì¹´ë©”ë¼ ì‹œì•¼ì— ë“¤ì–´ì˜¤ëŠ” ê°ì²´ë§Œ ë Œë”ë§í•˜ëŠ” ê¸°ë²•

```
     ì¹´ë©”ë¼ ë·° (Frustum)
         â•±â”€â”€â”€â”€â”€â”€â”€â•²
        â•±    â—    â•²     â— = ë³´ì´ëŠ” íƒ€ì¼ (ë Œë”ë§)
       â•±   â—   â—   â•²    Ã— = ì•ˆ ë³´ì´ëŠ” íƒ€ì¼ (ìŠ¤í‚µ)
      â•±â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•²
     Ã—    Ã—    Ã—    Ã— 
```

**3Dì—ì„œëŠ” 6ë©´ì²´(ì ˆë‘ì²´), 2Dì—ì„œëŠ” ì‚¬ê°í˜•**

### 3.3 VisibleTileRange êµ¬ì¡°ì²´

```cpp
struct VisibleTileRange {
    int zoom = 0;
    int minX = 0, maxX = 0;  // Xì¶• ë²”ìœ„ [minX, maxX] (ì–‘ ë í¬í•¨)
    int minY = 0, maxY = 0;  // Yì¶• ë²”ìœ„ [minY, maxY]
    
    int tileCount() const noexcept {
        return (maxX - minX + 1) * (maxY - minY + 1);
    }
};
```

**ì™œ êµ¬ì¡°ì²´ë¡œ ë²”ìœ„ë¥¼ í‘œí˜„í•˜ëŠ”ê°€?**

```cpp
// ë°©ë²• 1: ë²¡í„° ë°˜í™˜ (ë¹„íš¨ìœ¨ì )
std::vector<TileKey> getVisibleTiles();  // ë§¤ í”„ë ˆì„ í• ë‹¹ ë°œìƒ

// ë°©ë²• 2: ë²”ìœ„ ë°˜í™˜ (íš¨ìœ¨ì )
VisibleTileRange getVisibleRange();  // ë‹¨ìˆœ ê°’ ë³µì‚¬, í• ë‹¹ ì—†ìŒ
```

### 3.4 computeVisibleRange ì•Œê³ ë¦¬ì¦˜

```cpp
static VisibleTileRange computeVisibleRange(
    const Camera2D& camera,
    int fbW, int fbH,
    int zoom)
{
    // 1) í™”ë©´ ëª¨ì„œë¦¬ë¥¼ ì›”ë“œ ì¢Œí‘œë¡œ ë³€í™˜
    const glm::vec2 topLeft = camera.screenToWorld(0, 0);
    const glm::vec2 bottomRight = camera.screenToWorld(fbW, fbH);
    
    // 2) ì›”ë“œ ì¢Œí‘œë¥¼ íƒ€ì¼ ì¸ë±ìŠ¤ë¡œ ë³€í™˜
    range.minX = worldPxToTileIndex(topLeft.x);
    range.maxX = worldPxToTileIndex(bottomRight.x);
    range.minY = worldPxToTileIndex(topLeft.y);
    range.maxY = worldPxToTileIndex(bottomRight.y);
    
    // 3) ìœ íš¨ ë²”ìœ„ë¡œ í´ë¨í”„
    const int maxIdx = (1 << zoom) - 1;  // 2^zoom - 1
    range.minX = std::max(0, range.minX);
    range.maxX = std::min(maxIdx, range.maxX);
    ...
}
```

### 3.5 ë‹¨ê³„ë³„ ì˜ˆì‹œ

**ì„¤ì •:**
- í™”ë©´: 800Ã—600
- ì¹´ë©”ë¼: ì›”ë“œ ì¢Œí‘œ (500, 300) ì¤‘ì‹¬
- ì¤Œ ë ˆë²¨: 12

**1ë‹¨ê³„: í™”ë©´ â†’ ì›”ë“œ ì¢Œí‘œ**
```
í™”ë©´ ì¢Œìƒë‹¨ (0, 0) â†’ ì›”ë“œ (500, 300)
í™”ë©´ ìš°í•˜ë‹¨ (800, 600) â†’ ì›”ë“œ (1300, 900)
```

**2ë‹¨ê³„: ì›”ë“œ ì¢Œí‘œ â†’ íƒ€ì¼ ì¸ë±ìŠ¤**
```
minX = floor(500 / 256) = 1
maxX = floor(1300 / 256) = 5
minY = floor(300 / 256) = 1
maxY = floor(900 / 256) = 3
```

**3ë‹¨ê³„: ìœ íš¨ ë²”ìœ„ í´ë¨í”„**
```
zoom 12: maxIdx = 4095
ëª¨ë“  ê°’ì´ [0, 4095] ë²”ìœ„ ë‚´ â†’ ë³€ê²½ ì—†ìŒ
```

**ê²°ê³¼:**
```
íƒ€ì¼ ë²”ìœ„: X[1, 5], Y[1, 3]
íƒ€ì¼ ìˆ˜: (5-1+1) Ã— (3-1+1) = 5 Ã— 3 = 15ê°œ
```

**ì‹œê°í™”:**
```
     0    1    2    3    4    5    6
   â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
 0 â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
   â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
 1 â”‚    â”‚â–ˆâ–ˆâ–ˆâ–ˆâ”‚â–ˆâ–ˆâ–ˆâ–ˆâ”‚â–ˆâ–ˆâ–ˆâ–ˆâ”‚â–ˆâ–ˆâ–ˆâ–ˆâ”‚â–ˆâ–ˆâ–ˆâ–ˆâ”‚    â”‚ â† í™”ë©´ì— ë³´ì„
   â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
 2 â”‚    â”‚â–ˆâ–ˆâ–ˆâ–ˆâ”‚â–ˆâ–ˆâ–ˆâ–ˆâ”‚â–ˆâ–ˆâ–ˆâ–ˆâ”‚â–ˆâ–ˆâ–ˆâ–ˆâ”‚â–ˆâ–ˆâ–ˆâ–ˆâ”‚    â”‚
   â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
 3 â”‚    â”‚â–ˆâ–ˆâ–ˆâ–ˆâ”‚â–ˆâ–ˆâ–ˆâ–ˆâ”‚â–ˆâ–ˆâ–ˆâ–ˆâ”‚â–ˆâ–ˆâ–ˆâ–ˆâ”‚â–ˆâ–ˆâ–ˆâ–ˆâ”‚    â”‚
   â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
 4 â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚    â”‚
   â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
```

### 3.6 ë¹„íŠ¸ ì—°ì‚°: `1 << zoom`

```cpp
const int maxIdx = (1 << zoom) - 1;
```

**`1 << n`ì˜ ì˜ë¯¸:**
```
1 << 0  = 0b00000001 = 1
1 << 1  = 0b00000010 = 2
1 << 2  = 0b00000100 = 4
1 << 12 = 0b1000000000000 = 4096
```

**ì™œ `pow(2, zoom)` ëŒ€ì‹  ë¹„íŠ¸ ì‹œí”„íŠ¸?**
- `pow(2, 12)` â†’ ë¶€ë™ì†Œìˆ˜ì  ì—°ì‚° + ë¼ì´ë¸ŒëŸ¬ë¦¬ í˜¸ì¶œ
- `1 << 12` â†’ CPU ëª…ë ¹ 1ê°œ (ì¦‰ì‹œ ì‹¤í–‰)

**ì„±ëŠ¥ ì°¨ì´: 10ë°° ì´ìƒ**

### 3.7 C++ std::max/std::min

```cpp
range.minX = std::max(0, range.minX);
range.maxX = std::min(maxIdx, range.maxX);
```

**ì£¼ì˜ì‚¬í•­:**
```cpp
// í‹€ë¦° ì˜ˆ (íƒ€ì… ë¶ˆì¼ì¹˜)
std::max(0, someUnsignedInt);  // ì»´íŒŒì¼ ì—ëŸ¬ ë˜ëŠ” ê²½ê³ 

// ì˜¬ë°”ë¥¸ ì˜ˆ
std::max(0u, someUnsignedInt);  // unsigned ë¦¬í„°ëŸ´
std::max<int>(0, someInt);      // ëª…ì‹œì  íƒ€ì…
```

### ğŸ“ í•µì‹¬ ì •ë¦¬

| ê°œë… | ì„¤ëª… | ì‹œê°„ ë³µì¡ë„ |
|-----|------|-----------|
| ì ˆë‘ì²´ ì»¬ë§ | ë³´ì´ëŠ” ê²ƒë§Œ ë Œë”ë§ | O(1) ê³„ì‚° |
| ë²”ìœ„ vs ë²¡í„° | ë©”ëª¨ë¦¬ í• ë‹¹ ìµœì†Œí™” | O(1) vs O(n) |
| ë¹„íŠ¸ ì‹œí”„íŠ¸ | 2ì˜ ê±°ë“­ì œê³± ë¹ ë¥¸ ê³„ì‚° | O(1) |

---

# 4. TileCache: LRU ìºì‹œ ì•Œê³ ë¦¬ì¦˜

## ğŸ“– ì½ê¸° ì‹œê°„: 20ë¶„

### 4.1 ì™œ ìºì‹œê°€ í•„ìš”í•œê°€?

**ë¬¸ì œ:**
```
íƒ€ì¼ ë‹¤ìš´ë¡œë“œ: ~100ms (ë„¤íŠ¸ì›Œí¬)
60 FPS ëª©í‘œ: 16ms/í”„ë ˆì„

100ms > 16ms â†’ í”„ë ˆì„ ë“œë! ğŸ”´
```

**í•´ê²°:**
```
ì²« ë°©ë¬¸: 100ms (ë‹¤ìš´ë¡œë“œ)
ì¬ë°©ë¬¸: <1ms (ìºì‹œì—ì„œ ì¡°íšŒ) âœ…
```

### 4.2 LRU (Least Recently Used) ì•Œê³ ë¦¬ì¦˜

**ì›ë¦¬**: ê°€ì¥ ì˜¤ë˜ ì‚¬ìš©í•˜ì§€ ì•Šì€ í•­ëª©ì„ ë¨¼ì € ì œê±°

```
ì‹œê°„ â†’
ì‚¬ìš© ìˆœì„œ: A â†’ B â†’ C â†’ A â†’ D

ìºì‹œ ìƒíƒœ (ìš©ëŸ‰: 3):
[A]           â†’ A ì¶”ê°€
[B, A]        â†’ B ì¶”ê°€
[C, B, A]     â†’ C ì¶”ê°€ (ê°€ë“ ì°¸)
[A, C, B]     â†’ A ì¬ì‚¬ìš© (ì•ìœ¼ë¡œ ì´ë™)
[D, A, C]     â†’ D ì¶”ê°€, B ì œê±° (ê°€ì¥ ì˜¤ë˜ë¨)
```

### 4.3 ìë£Œêµ¬ì¡° ì„¤ê³„

```cpp
class TileCache {
    // 1) LRU ìˆœì„œë¥¼ ì¶”ì í•˜ëŠ” ì—°ê²° ë¦¬ìŠ¤íŠ¸
    std::list<TileKey> lruList_;
    // front = ìµœê·¼ ì‚¬ìš©, back = ê°€ì¥ ì˜¤ë˜ ì‚¬ìš© ì•ˆ í•¨
    
    // 2) ë¹ ë¥¸ ì¡°íšŒë¥¼ ìœ„í•œ í•´ì‹œë§µ
    std::unordered_map<TileKey, CacheNode> cache_;
    
    struct CacheNode {
        CacheEntry entry;                       // í…ìŠ¤ì²˜, í¬ê¸°
        std::list<TileKey>::iterator lruIter;   // ë¦¬ìŠ¤íŠ¸ ë‚´ ìœ„ì¹˜
    };
};
```

**ì™œ ë‘ ìë£Œêµ¬ì¡°ë¥¼ ì¡°í•©í•˜ëŠ”ê°€?**

| ì—°ì‚° | listë§Œ | mapë§Œ | list + map |
|-----|--------|-------|------------|
| ì¡°íšŒ | O(n) | O(1) | O(1) |
| LRU ì‚­ì œ | O(1) | O(n) | O(1) |
| ìˆœì„œ ì—…ë°ì´íŠ¸ | O(1)* | O(n) | O(1) |

**í•µì‹¬ íŠ¸ë¦­: iterator ì €ì¥**
```cpp
std::list<TileKey>::iterator lruIter;
```
- mapì—ì„œ list ìœ„ì¹˜ë¥¼ O(1)ë¡œ ì•Œ ìˆ˜ ìˆìŒ
- list::erase(iter)ëŠ” O(1)

### 4.4 ì£¼ìš” ì—°ì‚° êµ¬í˜„

#### 4.4.1 get() - ìºì‹œ ì¡°íšŒ

```cpp
bool TileCache::get(const TileKey& key, TexHandle& outTex) {
    auto it = cache_.find(key);      // O(1) í•´ì‹œë§µ ì¡°íšŒ
    if (it == cache_.end()) {
        ++missCount_;
        return false;                 // ìºì‹œ ë¯¸ìŠ¤
    }
    
    moveToFront(key);                 // LRU ì—…ë°ì´íŠ¸
    outTex = it->second.entry.texture;
    ++hitCount_;
    return true;                      // ìºì‹œ íˆíŠ¸
}
```

#### 4.4.2 moveToFront() - LRU ìˆœì„œ ì—…ë°ì´íŠ¸

```cpp
void TileCache::moveToFront(const TileKey& key) {
    auto it = cache_.find(key);
    
    // ë¦¬ìŠ¤íŠ¸ì—ì„œ í˜„ì¬ ìœ„ì¹˜ ì œê±°
    lruList_.erase(it->second.lruIter);
    
    // ë¦¬ìŠ¤íŠ¸ ë§¨ ì•ì— ì¶”ê°€
    lruList_.push_front(key);
    
    // ìƒˆ ìœ„ì¹˜ë¡œ iterator ì—…ë°ì´íŠ¸
    it->second.lruIter = lruList_.begin();
}
```

**ì‹œê°í™”:**
```
ì´ì „: [B] â†” [C] â†” [A] â†” [D]
      ìµœê·¼           ì˜¤ë˜ë¨

get(A) í˜¸ì¶œ í›„:
      [A] â†” [B] â†” [C] â†” [D]
      ìµœê·¼!
```

#### 4.4.3 put() - ìƒˆ í•­ëª© ì¶”ê°€

```cpp
void TileCache::put(const TileKey& key, TexHandle tex, size_t sizeBytes) {
    // 1) ì´ë¯¸ ì¡´ì¬í•˜ë©´ ì‚­ì œ (ë®ì–´ì“°ê¸°)
    if (cache_.contains(key)) {
        // ê¸°ì¡´ í•­ëª© ì œê±°...
    }
    
    // 2) ê³µê°„ í™•ë³´
    evictIfNeeded(budgetBytes_ - sizeBytes);
    
    // 3) ë¦¬ìŠ¤íŠ¸ ë§¨ ì•ì— ì¶”ê°€
    lruList_.push_front(key);
    
    // 4) ë§µì— ì €ì¥
    cache_[key] = {entry, lruList_.begin()};
    usedBytes_ += sizeBytes;
}
```

#### 4.4.4 evictOne() - ê°€ì¥ ì˜¤ë˜ëœ í•­ëª© ì œê±°

```cpp
void TileCache::evictOne() {
    // ë¦¬ìŠ¤íŠ¸ ë§¨ ë’¤ = ê°€ì¥ ì˜¤ë˜ ì‚¬ìš© ì•ˆ í•¨
    const TileKey& lruKey = lruList_.back();
    
    auto it = cache_.find(lruKey);
    
    // OpenGL í…ìŠ¤ì²˜ ì‚­ì œ (ì¤‘ìš”: GPU ë©”ëª¨ë¦¬ í•´ì œ)
    glDeleteTextures(1, &it->second.entry.texture);
    
    usedBytes_ -= it->second.entry.sizeBytes;
    cache_.erase(it);
    lruList_.pop_back();
}
```

### 4.5 ë©”ëª¨ë¦¬ ì˜ˆì‚° ê´€ë¦¬

```cpp
static constexpr size_t kDefaultBudgetBytes = 128 * 1024 * 1024;  // 128MB
```

**íƒ€ì¼ ë©”ëª¨ë¦¬ ê³„ì‚°:**
```
1 íƒ€ì¼ = 256 Ã— 256 Ã— 4 bytes (RGBA)
       = 262,144 bytes
       = 256 KB

128 MB / 256 KB = 512 íƒ€ì¼
```

**ì™œ 128MB?**
- ì¼ë°˜ì ì¸ GPU: 2-8GB VRAM
- 128MBëŠ” ì „ì²´ì˜ 1.5~6% â†’ ì•ˆì „í•œ ìˆ˜ì¤€
- ëª¨ë°”ì¼ GPUëŠ” ë” ì ê²Œ ì„¤ì • í•„ìš”

### 4.6 OpenGL ë¦¬ì†ŒìŠ¤ ê´€ë¦¬

```cpp
// í…ìŠ¤ì²˜ ìƒì„± (GPUì— ì—…ë¡œë“œ)
GLuint tex;
glGenTextures(1, &tex);
glBindTexture(GL_TEXTURE_2D, tex);
glTexImage2D(..., pixels);

// í…ìŠ¤ì²˜ ì‚­ì œ (GPU ë©”ëª¨ë¦¬ í•´ì œ)
glDeleteTextures(1, &tex);
```

**í•µì‹¬**: ìºì‹œì—ì„œ ì œê±°í•  ë•Œ ë°˜ë“œì‹œ `glDeleteTextures` í˜¸ì¶œ!
- í˜¸ì¶œ ì•ˆ í•˜ë©´ GPU ë©”ëª¨ë¦¬ ëˆ„ìˆ˜
- ê²°êµ­ VRAM ë¶€ì¡±ìœ¼ë¡œ í¬ë˜ì‹œ

### 4.7 C++ ê´€ìš©êµ¬: ìºì‹œ ì•ˆì „ ì‚­ì œ

```cpp
// ì•ˆì „í•œ ë°©ë²•: erase ì „ì— iterator ì‚¬ìš©
auto it = cache_.find(key);
if (it != cache_.end()) {
    lruList_.erase(it->second.lruIter);  // ë¨¼ì € list ì •ë¦¬
    glDeleteTextures(1, &it->second.entry.texture);
    cache_.erase(it);                     // ë§ˆì§€ë§‰ì— map ì‚­ì œ
}
```

**ìˆœì„œ ì¤‘ìš”!**
1. listì—ì„œ ì œê±° (iteratorê°€ ì•„ì§ ìœ íš¨)
2. ë¦¬ì†ŒìŠ¤ í•´ì œ (entry ì•„ì§ ìœ íš¨)
3. mapì—ì„œ ì œê±° (entry ë¬´íš¨í™”)

### ğŸ“ í•µì‹¬ ì •ë¦¬

| ê°œë… | ì‹œê°„ ë³µì¡ë„ | í•µì‹¬ í¬ì¸íŠ¸ |
|-----|-----------|------------|
| LRU get | O(1) | iterator ì €ì¥ì´ í•µì‹¬ |
| LRU put | O(1) | ì˜ˆì‚° ì´ˆê³¼ ì‹œ evict |
| LRU evict | O(1) | list.back() = ê°€ì¥ ì˜¤ë˜ë¨ |
| ë©”ëª¨ë¦¬ ê´€ë¦¬ | - | glDeleteTextures í•„ìˆ˜! |

---

# 5. TileRenderer: íŒŒì´í”„ë¼ì¸ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜

## ğŸ“– ì½ê¸° ì‹œê°„: 15ë¶„

### 5.1 ì—­í• 

TileRendererëŠ” ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ë¥¼ ì¡°ìœ¨í•˜ëŠ” **ì§€íœ˜ì(Orchestrator)**ì…ë‹ˆë‹¤.

```
TileGrid (ë³´ì´ëŠ” íƒ€ì¼ ê³„ì‚°)
    â†“
TileCache (ìºì‹œ í™•ì¸)
    â†“
TileDownloader (ë‹¤ìš´ë¡œë“œ)
    â†“
PngCodec (ë””ì½”ë”©)
    â†“
TextureManager (GPU ì—…ë¡œë“œ)
    â†“
QuadRenderer (í™”ë©´ì— ê·¸ë¦¬ê¸°)
```

### 5.2 í”„ë ˆì„ë‹¹ ë‹¤ìš´ë¡œë“œ ì œí•œ

```cpp
constexpr int kMaxDownloadsPerFrame = 3;
int downloadsThisFrame = 0;

for (ê° íƒ€ì¼) {
    if (!inCache && downloadsThisFrame < 3) {
        tex = downloadTile(key);
        ++downloadsThisFrame;
    } else if (!inCache) {
        tex = placeholder;  // ë‹¤ìš´ë¡œë“œ ì œí•œ ì´ˆê³¼
    }
}
```

**ì™œ ì œí•œí•˜ëŠ”ê°€?**

```
ë¬¸ì œ:
ì¤Œ ë³€ê²½ â†’ 15ê°œ íƒ€ì¼ ëª¨ë‘ ìºì‹œ ë¯¸ìŠ¤
â†’ 15 Ã— 100ms = 1.5ì´ˆ ë¸”ë¡œí‚¹
â†’ í™”ë©´ ë©ˆì¶¤ ğŸ˜±

í•´ê²°:
í”„ë ˆì„ 1: 3ê°œ ë‹¤ìš´ë¡œë“œ (300ms), 12ê°œ placeholder
í”„ë ˆì„ 2: 3ê°œ ë” ë‹¤ìš´ë¡œë“œ, 9ê°œ placeholder
...
â†’ ì ì§„ì  ë¡œë”©, ë¶€ë“œëŸ¬ìš´ UX ğŸ‰
```

### 5.3 Placeholder í…ìŠ¤ì²˜

```cpp
void TileRenderer::createPlaceholderTexture() {
    constexpr int size = 256;
    constexpr int checkSize = 16;  // ì²´ì»¤ë³´ë“œ ì…€ í¬ê¸°
    
    for (int y = 0; y < size; ++y) {
        for (int x = 0; x < size; ++x) {
            bool dark = ((x / 16) + (y / 16)) % 2 == 0;
            uint8_t gray = dark ? 180 : 200;
            pixels[idx] = {gray, gray, gray, 255};
        }
    }
}
```

**ì²´ì»¤ë³´ë“œ ìˆ˜í•™:**
```
(x/16 + y/16) % 2

ì˜ˆ: x=0, y=0   â†’ (0 + 0) % 2 = 0 (ì–´ë‘ì›€)
    x=16, y=0  â†’ (1 + 0) % 2 = 1 (ë°ìŒ)
    x=16, y=16 â†’ (1 + 1) % 2 = 0 (ì–´ë‘ì›€)
```

**ì‹œê°í™” (4Ã—4 ì˜ˆì‹œ):**
```
â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”
â”‚â–‘â–‘â–‘â”‚   â”‚â–‘â–‘â–‘â”‚   â”‚
â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
â”‚   â”‚â–‘â–‘â–‘â”‚   â”‚â–‘â–‘â–‘â”‚
â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
â”‚â–‘â–‘â–‘â”‚   â”‚â–‘â–‘â–‘â”‚   â”‚
â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤
â”‚   â”‚â–‘â–‘â–‘â”‚   â”‚â–‘â–‘â–‘â”‚
â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜
```

### 5.4 ì •ìˆ˜ í”½ì…€ ìŠ¤ëƒ…í•‘

```cpp
render::Quad q;
q.x = static_cast<int>(std::floor(worldPos.x));  // ì •ìˆ˜ë¡œ ìŠ¤ëƒ…
q.y = static_cast<int>(std::floor(worldPos.y));
```

**ì™œ ì •ìˆ˜ë¡œ ìŠ¤ëƒ…í•˜ëŠ”ê°€?**

```
ë¬¸ì œ: ë¶€ë™ì†Œìˆ˜ì  ì¢Œí‘œ
íƒ€ì¼ 1: x = 255.999...
íƒ€ì¼ 2: x = 256.0
â†’ ë Œë”ë§ ì‹œ 1í”½ì…€ í‹ˆìƒˆ ë°œìƒ (seam)

í•´ê²°: ì •ìˆ˜ë¡œ ìŠ¤ëƒ…
íƒ€ì¼ 1: x = floor(255.999) = 255
íƒ€ì¼ 2: x = floor(256.0) = 256
â†’ ì™„ë²½íˆ ì¸ì ‘, í‹ˆìƒˆ ì—†ìŒ
```

### 5.5 drawTiles ì „ì²´ íë¦„

```cpp
int TileRenderer::drawTiles(QuadRenderer& quad, Camera2D& cam, int zoom, int fbW, int fbH) {
    // 1) ë³´ì´ëŠ” íƒ€ì¼ ë²”ìœ„ ê³„ì‚°
    auto range = TileGrid::computeVisibleRange(cam, fbW, fbH, zoom);
    
    // 2) MVP í–‰ë ¬ ê³„ì‚°
    glm::mat4 mvp = cam.mvp(fbW, fbH);
    
    // 3) ê° íƒ€ì¼ ë Œë”ë§
    for (y in range.minY..maxY) {
        for (x in range.minX..maxX) {
            TileKey key(zoom, x, y);
            
            // ìºì‹œ í™•ì¸
            TexHandle tex;
            if (cache.get(key, tex)) {
                // ìºì‹œ íˆíŠ¸
            } else if (downloadsThisFrame < 3) {
                tex = download(key);  // ë‹¤ìš´ë¡œë“œ
            } else {
                tex = placeholder;    // ì œí•œ ì´ˆê³¼
            }
            
            // ì›”ë“œ ì¢Œí‘œ ê³„ì‚° ë° ë Œë”ë§
            glm::vec2 pos = tileToWorldPixel(key);
            Quad q = {floor(pos.x), floor(pos.y), 256, 256};
            quadRenderer.draw(tex, q, mvp);
        }
    }
}
```

### ğŸ“ í•µì‹¬ ì •ë¦¬

| ê°œë… | ëª©ì  | ê¸°ë²• |
|-----|-----|------|
| ë‹¤ìš´ë¡œë“œ ì œí•œ | ë¸”ë¡œí‚¹ ë°©ì§€ | í”„ë ˆì„ë‹¹ ìµœëŒ€ 3ê°œ |
| Placeholder | ë¡œë”© ì¤‘ í‘œì‹œ | íšŒìƒ‰ ì²´ì»¤ë³´ë“œ |
| í”½ì…€ ìŠ¤ëƒ…í•‘ | íƒ€ì¼ ê²½ê³„ í‹ˆìƒˆ ë°©ì§€ | floor() |
| ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ | ì»´í¬ë„ŒíŠ¸ ì¡°ìœ¨ | íŒŒì´í”„ë¼ì¸ íŒ¨í„´ |

---

# 6. Camera2D: ë³€í™˜ í–‰ë ¬ê³¼ ì¢Œí‘œ ë³€í™˜

## ğŸ“– ì½ê¸° ì‹œê°„: 20ë¶„

### 6.1 ì¢Œí‘œê³„ ì •ì˜

```
ìŠ¤í¬ë¦° ì¢Œí‘œ (Screen Space)     ì›”ë“œ ì¢Œí‘œ (World Space)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               
â”‚(0,0)     (W,0)              (worldOriginX, worldOriginY)
â”‚             â”‚                     â†“
â”‚             â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚(0,H)     (W,H)              â”‚ íƒ€ì¼ íƒ€ì¼ íƒ€ì¼ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚ íƒ€ì¼ íƒ€ì¼ íƒ€ì¼ â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Y-Down ì¢Œí‘œê³„**:
- í™”ë©´: (0,0)ì´ ì¢Œìƒë‹¨, Yê°€ ì•„ë˜ë¡œ ì¦ê°€
- OpenGL ê¸°ë³¸: Y-Up (ìš°ë¦¬ëŠ” ë°˜ì „í•¨)

### 6.2 ë³€í™˜ ê³¼ì •

```
ì›”ë“œ ì¢Œí‘œ â†’ ë·° ë³€í™˜ â†’ ìŠ¤í¬ë¦° ì¢Œí‘œ â†’ íˆ¬ì˜ ë³€í™˜ â†’ í´ë¦½ ì¢Œí‘œ â†’ NDC
```

#### 6.2.1 ë·° í–‰ë ¬ (View Matrix)

```cpp
glm::mat4 Camera2D::viewMatrix() const noexcept {
    glm::mat4 view(1.0f);  // ë‹¨ìœ„ í–‰ë ¬
    
    // 1) ìŠ¤ì¼€ì¼ (ì¤Œ)
    view = glm::scale(view, glm::vec3(scale_, scale_, 1.0f));
    
    // 2) í‰í–‰ ì´ë™ (ì¹´ë©”ë¼ ìœ„ì¹˜)
    view = glm::translate(view, glm::vec3(-worldOriginX_, -worldOriginY_, 0.0f));
    
    return view;
}
```

**ì™œ `-worldOrigin`ì¸ê°€?**

```
ì§ê´€: "ì¹´ë©”ë¼ê°€ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì´ë™"
ì‹¤ì œ: "ì„¸ìƒì´ ì™¼ìª½ìœ¼ë¡œ ì´ë™"

ì¹´ë©”ë¼ ìœ„ì¹˜ (100, 50)
â†’ ëª¨ë“  ê°ì²´ë¥¼ (-100, -50)ë§Œí¼ ì´ë™
â†’ ì¹´ë©”ë¼ê°€ (100, 50)ì— ìˆëŠ” íš¨ê³¼
```

**í–‰ë ¬ ìˆ˜í•™:**
```
| scale   0     0   -origin.x * scale |
|   0   scale   0   -origin.y * scale |
|   0     0     1           0         |
|   0     0     0           1         |
```

#### 6.2.2 íˆ¬ì˜ í–‰ë ¬ (Orthographic Projection)

```cpp
glm::mat4 Camera2D::ortho(int fbW, int fbH) const noexcept {
    // Y-down ì¢Œí‘œê³„: topê³¼ bottomì„ ë’¤ì§‘ìŒ
    return glm::ortho(
        0.0f,                        // left
        static_cast<float>(fbW),     // right
        static_cast<float>(fbH),     // bottom (Y-downì´ë¯€ë¡œ heightê°€ bottom)
        0.0f,                        // top (Y-downì´ë¯€ë¡œ 0ì´ top)
        -1.0f, 1.0f                  // near, far
    );
}
```

**ì •ì‚¬ì˜(Orthographic) vs ì›ê·¼(Perspective):**
```
ì •ì‚¬ì˜: ê±°ë¦¬ì— ìƒê´€ì—†ì´ í¬ê¸° ë™ì¼ (2D ê²Œì„)
ì›ê·¼: ë©€ìˆ˜ë¡ ì‘ê²Œ (3D ê²Œì„)
```

**ortho í–‰ë ¬ ìˆ˜í•™:**
```
| 2/(r-l)    0       0    -(r+l)/(r-l) |
|    0    2/(t-b)    0    -(t+b)/(t-b) |
|    0       0    -2/(f-n) -(f+n)/(f-n)|
|    0       0       0          1      |
```

Y-Downì„ ìœ„í•´ top=0, bottom=Hë¡œ ì„¤ì •í•˜ë©´:
```
t=0, b=600ì¼ ë•Œ:
2/(t-b) = 2/(0-600) = -1/300  (ìŒìˆ˜ â†’ Yì¶• ë°˜ì „)
```

#### 6.2.3 MVP í–‰ë ¬

```cpp
glm::mat4 Camera2D::mvp(int fbW, int fbH) const noexcept {
    return ortho(fbW, fbH) * viewMatrix();
}
```

**í–‰ë ¬ ê³±ì…ˆ ìˆœì„œ ì¤‘ìš”!**
```
ìµœì¢… ì¢Œí‘œ = Projection Ã— View Ã— Model Ã— ì •ì 

ì½”ë“œì—ì„œëŠ” ì˜¤ë¥¸ìª½ì—ì„œ ì™¼ìª½ìœ¼ë¡œ ì ìš©:
mvp = P Ã— V
ì •ì ' = mvp Ã— ì •ì  = P Ã— (V Ã— ì •ì )
```

### 6.3 screenToWorld ë³€í™˜

```cpp
glm::vec2 Camera2D::screenToWorld(float sx, float sy) const noexcept {
    return glm::vec2(
        worldOriginX_ + sx / scale_,
        worldOriginY_ + sy / scale_
    );
}
```

**ìœ ë„:**
```
ìŠ¤í¬ë¦° ì¢Œí‘œ â†’ ë·° ë³€í™˜ ì—­ â†’ ì›”ë“œ ì¢Œí‘œ

screen = (world - origin) * scale
world = screen / scale + origin
```

### 6.4 zoomAt (ì»¤ì„œ ì¤‘ì‹¬ ì¤Œ)

```cpp
void Camera2D::zoomAt(float cx, float cy, float zoomDelta, int fbW, int fbH) noexcept {
    // 1) ì¤Œ ì „ ì»¤ì„œì˜ ì›”ë“œ ì¢Œí‘œ
    const glm::vec2 worldBefore = screenToWorld(cx, cy);
    
    // 2) ìŠ¤ì¼€ì¼ ì—…ë°ì´íŠ¸
    scale_ *= (1.0f + zoomDelta * kZoomSpeed);
    scale_ = glm::clamp(scale_, kMinScale, kMaxScale);
    
    // 3) ì¤Œ í›„ ì»¤ì„œì˜ ì›”ë“œ ì¢Œí‘œ (ìƒˆ ìŠ¤ì¼€ì¼ ì ìš©)
    const glm::vec2 worldAfter = screenToWorld(cx, cy);
    
    // 4) ì°¨ì´ë§Œí¼ ì›ì  ë³´ì •
    worldOriginX_ += worldBefore.x - worldAfter.x;
    worldOriginY_ += worldBefore.y - worldAfter.y;
}
```

**ì™œ ì´ë ‡ê²Œ ë³µì¡í•œê°€?**

```
ë‹¨ìˆœ ì¤Œ (í™”ë©´ ì¤‘ì•™ ê¸°ì¤€):
ì¤Œ ì¸ â†’ ì§€ë„ê°€ í™•ëŒ€ë˜ë©´ì„œ ì»¤ì„œ ì•„ë˜ ì§€ì ì´ ì´ë™

ì»¤ì„œ ì¤‘ì‹¬ ì¤Œ:
ì¤Œ ì¸ â†’ ì»¤ì„œ ì•„ë˜ ì§€ì ì´ ê·¸ëŒ€ë¡œ ìœ ì§€ (Google Mapsì²˜ëŸ¼)
```

**ì‹œê°í™”:**
```
ì¤Œ ì „:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      *      â”‚  * = ì»¤ì„œ (ì„œìš¸ì‹œì²­)
â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ë‹¨ìˆœ ì¤Œ ì¸:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚*            â”‚  â† ì„œìš¸ì‹œì²­ì´ ì™¼ìª½ìœ¼ë¡œ ì´ë™ (ë‚˜ìœ UX)
â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ì»¤ì„œ ì¤‘ì‹¬ ì¤Œ ì¸:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      *      â”‚  â† ì„œìš¸ì‹œì²­ì´ ê·¸ëŒ€ë¡œ (ì¢‹ì€ UX)
â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.5 ìˆ˜í•™ ì—°ìŠµ

**ë¬¸ì œ**: ì»¤ì„œ (400, 300), ì¤Œ ì „ scale=1.0, ì¤Œ í›„ scale=1.1, origin=(0,0)

```
1) ì¤Œ ì „ ì›”ë“œ ì¢Œí‘œ:
   world = screen / scale + origin
        = (400, 300) / 1.0 + (0, 0)
        = (400, 300)

2) ìƒˆ ìŠ¤ì¼€ì¼: 1.1

3) ì¤Œ í›„ ì›”ë“œ ì¢Œí‘œ (ì›ì  ë³´ì • ì—†ì´):
   world' = (400, 300) / 1.1 + (0, 0)
          = (363.6, 272.7)

4) ì›ì  ë³´ì •:
   delta = worldBefore - worldAfter
        = (400, 300) - (363.6, 272.7)
        = (36.4, 27.3)
   
   newOrigin = (0, 0) + (36.4, 27.3) = (36.4, 27.3)
```

**ê²°ê³¼**: ì¤Œ ì¸ í›„ ì›ì ì´ (36.4, 27.3)ìœ¼ë¡œ ì´ë™
â†’ ì»¤ì„œ ì•„ë˜ ì§€ì ì´ í™”ë©´ìƒ ê°™ì€ ìœ„ì¹˜ ìœ ì§€!

### ğŸ“ í•µì‹¬ ì •ë¦¬

| ê°œë… | ê³µì‹ | ëª©ì  |
|-----|-----|------|
| ë·° í–‰ë ¬ | scale Ã— translate(-origin) | ì¹´ë©”ë¼ ìœ„ì¹˜/ì¤Œ ì ìš© |
| íˆ¬ì˜ í–‰ë ¬ | ortho(0, W, H, 0) | í™”ë©´ ì¢Œí‘œ â†’ í´ë¦½ ì¢Œí‘œ |
| MVP | projection Ã— view | ì›”ë“œ â†’ í™”ë©´ ë³€í™˜ |
| screenToWorld | screen/scale + origin | ë§ˆìš°ìŠ¤ ì¢Œí‘œ â†’ ì›”ë“œ ì¢Œí‘œ |
| ì»¤ì„œ ì¤Œ | ì›ì  ë³´ì • | ìì—°ìŠ¤ëŸ¬ìš´ ì¤Œ ê²½í—˜ |

---

# 7. ì „ì²´ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨

## ğŸ“– ì½ê¸° ì‹œê°„: 10ë¶„

### 7.1 ì´ˆê¸°í™” ì‹œí€€ìŠ¤

```
main()
  â”‚
  â”œâ”€â–º GlBootstrap.init()
  â”‚     â””â”€â–º GLFW ìœˆë„ìš°/OpenGL ì»¨í…ìŠ¤íŠ¸ ìƒì„±
  â”‚
  â”œâ”€â–º QuadRenderer.init()
  â”‚     â”œâ”€â–º glGenVertexArrays() - VAO ìƒì„±
  â”‚     â”œâ”€â–º glGenBuffers() - VBO, EBO ìƒì„±
  â”‚     â””â”€â–º glCreateProgram() - ì…°ì´ë” ì»´íŒŒì¼/ë§í¬
  â”‚
  â”œâ”€â–º Camera2D ìƒì„±
  â”‚     â””â”€â–º ê¸°ë³¸ê°’: origin=(0,0), scale=1.0
  â”‚
  â”œâ”€â–º InputHandler.attach()
  â”‚     â”œâ”€â–º glfwSetMouseButtonCallback()
  â”‚     â”œâ”€â–º glfwSetCursorPosCallback()
  â”‚     â””â”€â–º glfwSetScrollCallback()
  â”‚
  â”œâ”€â–º TileCache(128MB) ìƒì„±
  â”‚
  â”œâ”€â–º TileRenderer ìƒì„±
  â”‚     â””â”€â–º createPlaceholderTexture() - íšŒìƒ‰ ì²´ì»¤ë³´ë“œ
  â”‚
  â””â”€â–º camera.setWorldOrigin(ì„œìš¸ì‹œì²­)
        â””â”€â–º ì´ˆê¸° ë·° ìœ„ì¹˜ ì„¤ì •
```

### 7.2 ë Œë” ë£¨í”„ ì‹œí€€ìŠ¤

```
while (!shouldClose())
  â”‚
  â”œâ”€â–º glfw.poll()
  â”‚     â””â”€â–º ì…ë ¥ ì½œë°± ë°œìƒ ì‹œ Camera2D ì—…ë°ì´íŠ¸
  â”‚
  â”œâ”€â–º glClear() - í™”ë©´ í´ë¦¬ì–´
  â”‚
  â”œâ”€â–º TileRenderer.drawTiles()
  â”‚     â”‚
  â”‚     â”œâ”€â–º TileGrid.computeVisibleRange()
  â”‚     â”‚     â”œâ”€â–º screenToWorld(0, 0) - ì¢Œìƒë‹¨
  â”‚     â”‚     â”œâ”€â–º screenToWorld(W, H) - ìš°í•˜ë‹¨
  â”‚     â”‚     â””â”€â–º worldPxToTileIndex() - íƒ€ì¼ ë²”ìœ„ ê³„ì‚°
  â”‚     â”‚
  â”‚     â”œâ”€â–º camera.mvp() - ë³€í™˜ í–‰ë ¬ ê³„ì‚°
  â”‚     â”‚
  â”‚     â””â”€â–º for each íƒ€ì¼
  â”‚           â”‚
  â”‚           â”œâ”€â–º cache.get(key)
  â”‚           â”‚     â”œâ”€â–º íˆíŠ¸: í…ìŠ¤ì²˜ ë°˜í™˜
  â”‚           â”‚     â””â”€â–º ë¯¸ìŠ¤: ë‹¤ìš´ë¡œë“œ ì‹œë„
  â”‚           â”‚           â”‚
  â”‚           â”‚           â”œâ”€â–º downloader.ensureRaster()
  â”‚           â”‚           â”‚     â””â”€â–º HTTP GET â†’ PNG bytes
  â”‚           â”‚           â”‚
  â”‚           â”‚           â”œâ”€â–º PngCodec.decode()
  â”‚           â”‚           â”‚     â””â”€â–º PNG â†’ RGBA pixels
  â”‚           â”‚           â”‚
  â”‚           â”‚           â”œâ”€â–º texMgr.createRGBA8()
  â”‚           â”‚           â”‚     â””â”€â–º glTexImage2D â†’ GPU ì—…ë¡œë“œ
  â”‚           â”‚           â”‚
  â”‚           â”‚           â””â”€â–º cache.put()
  â”‚           â”‚                 â””â”€â–º LRU ìºì‹œì— ì €ì¥
  â”‚           â”‚
  â”‚           â””â”€â–º quadRenderer.draw(tex, quad, mvp)
  â”‚                 â”œâ”€â–º glBindTexture()
  â”‚                 â”œâ”€â–º glUniformMatrix4fv(mvp)
  â”‚                 â””â”€â–º glDrawElements(6 vertices)
  â”‚
  â””â”€â–º glfwSwapBuffers() - í™”ë©´ ê°±ì‹ 
```

### 7.3 ì…ë ¥ ì²˜ë¦¬ ì‹œí€€ìŠ¤

```
ì‚¬ìš©ì: ë§ˆìš°ìŠ¤ ë“œë˜ê·¸
  â”‚
  â””â”€â–º GLFW ì½œë°±
        â”‚
        â””â”€â–º InputHandler.cursorCallback()
              â”‚
              â””â”€â–º camera.pan(dx, dy)
                    â”‚
                    â””â”€â–º worldOrigin -= (dx, dy) / scale
                          â”‚
                          â””â”€â–º ë‹¤ìŒ í”„ë ˆì„ì—ì„œ ìƒˆ íƒ€ì¼ ë²”ìœ„ ê³„ì‚°
```

```
ì‚¬ìš©ì: ìŠ¤í¬ë¡¤ íœ 
  â”‚
  â””â”€â–º GLFW ì½œë°±
        â”‚
        â””â”€â–º InputHandler.scrollCallback()
              â”‚
              â””â”€â–º camera.zoomAt(cx, cy, delta)
                    â”‚
                    â”œâ”€â–º scale ì—…ë°ì´íŠ¸
                    â””â”€â–º origin ë³´ì • (ì»¤ì„œ ê³ ì •)
                          â”‚
                          â””â”€â–º ë‹¤ìŒ í”„ë ˆì„ì—ì„œ ì¤Œ ë ˆë²¨ ì¬ê³„ì‚°
```

### 7.4 ë©”ëª¨ë¦¬ í•´ì œ ì‹œí€€ìŠ¤

```
ìœˆë„ìš° ì¢…ë£Œ
  â”‚
  â”œâ”€â–º cache.clear()
  â”‚     â””â”€â–º for each í…ìŠ¤ì²˜
  â”‚           â””â”€â–º glDeleteTextures()
  â”‚
  â”œâ”€â–º quadRenderer.shutdown()
  â”‚     â”œâ”€â–º glDeleteProgram()
  â”‚     â”œâ”€â–º glDeleteBuffers()
  â”‚     â””â”€â–º glDeleteVertexArrays()
  â”‚
  â””â”€â–º glBootstrap.shutdown()
        â”œâ”€â–º glfwDestroyWindow()
        â””â”€â–º glfwTerminate()
```

---

# 8. ì—°ìŠµ ë¬¸ì œ

## ğŸ“– í’€ì´ ì‹œê°„: 30ë¶„

### ë¬¸ì œ 1: íƒ€ì¼ ìˆ˜ ê³„ì‚° (ê¸°ì´ˆ)

**Q**: ì¤Œ ë ˆë²¨ 15ì—ì„œ ì „ì²´ íƒ€ì¼ ìˆ˜ëŠ”?

<details>
<summary>ì •ë‹µ ë³´ê¸°</summary>

```
íƒ€ì¼ ìˆ˜ = 2^z Ã— 2^z = 4^z
z = 15
íƒ€ì¼ ìˆ˜ = 2^15 Ã— 2^15 = 32768 Ã— 32768 = 1,073,741,824ê°œ (ì•½ 10ì–µ)
```

</details>

### ë¬¸ì œ 2: ì¢Œí‘œ ë³€í™˜ (ì¤‘ê¸‰)

**Q**: ì›”ë“œ ì¢Œí‘œ (1000, 750)ì´ ì†í•˜ëŠ” íƒ€ì¼ì˜ TileKeyëŠ”? (ì¤Œ 12)

<details>
<summary>ì •ë‹µ ë³´ê¸°</summary>

```
tileX = floor(1000 / 256) = floor(3.90) = 3
tileY = floor(750 / 256) = floor(2.92) = 2
â†’ TileKey(12, 3, 2)
```

</details>

### ë¬¸ì œ 3: ìºì‹œ ë©”ëª¨ë¦¬ (ì¤‘ê¸‰)

**Q**: 128MB ìºì‹œì— ìµœëŒ€ ëª‡ ê°œì˜ íƒ€ì¼ì„ ì €ì¥í•  ìˆ˜ ìˆë‚˜?

<details>
<summary>ì •ë‹µ ë³´ê¸°</summary>

```
1 íƒ€ì¼ = 256 Ã— 256 Ã— 4 bytes = 262,144 bytes = 256 KB
128 MB = 128 Ã— 1024 KB = 131,072 KB
ìµœëŒ€ íƒ€ì¼ ìˆ˜ = 131,072 / 256 = 512ê°œ
```

</details>

### ë¬¸ì œ 4: LRU ì‹œë®¬ë ˆì´ì…˜ (ê³ ê¸‰)

**Q**: ìºì‹œ ìš©ëŸ‰ 3, ì ‘ê·¼ ìˆœì„œ Aâ†’Bâ†’Câ†’Aâ†’Dâ†’Bâ†’Eì¼ ë•Œ ìµœì¢… ìºì‹œ ìƒíƒœëŠ”?

<details>
<summary>ì •ë‹µ ë³´ê¸°</summary>

```
[A]         â†’ A ì¶”ê°€
[B, A]      â†’ B ì¶”ê°€
[C, B, A]   â†’ C ì¶”ê°€ (ê°€ë“ ì°¸)
[A, C, B]   â†’ A ì¬ì‚¬ìš© (ì•ìœ¼ë¡œ ì´ë™)
[D, A, C]   â†’ D ì¶”ê°€, B ì œê±° (LRU)
[B, D, A]   â†’ B ì¶”ê°€, C ì œê±° (LRU)
[E, B, D]   â†’ E ì¶”ê°€, A ì œê±° (LRU)

ìµœì¢…: [E, B, D] (Eê°€ ê°€ì¥ ìµœê·¼)
```

</details>

### ë¬¸ì œ 5: MVP í–‰ë ¬ (ê³ ê¸‰)

**Q**: origin=(100, 50), scale=2.0ì¼ ë•Œ ì›”ë“œ ì¢Œí‘œ (200, 100)ì˜ ìŠ¤í¬ë¦° ì¢Œí‘œëŠ”?

<details>
<summary>ì •ë‹µ ë³´ê¸°</summary>

```
screen = (world - origin) Ã— scale
       = ((200, 100) - (100, 50)) Ã— 2.0
       = (100, 50) Ã— 2.0
       = (200, 100)
```

</details>

### ë¬¸ì œ 6: ì»¤ì„œ ì¤Œ (ê³ ê¸‰)

**Q**: origin=(0,0), scale=1.0ì—ì„œ ì»¤ì„œ (400, 300) ìœ„ì¹˜ì—ì„œ 1.2ë°° ì¤Œí•  ë•Œ ìƒˆ originì€?

<details>
<summary>ì •ë‹µ ë³´ê¸°</summary>

```
1) ì¤Œ ì „ ì›”ë“œ ì¢Œí‘œ:
   world_before = (400, 300) / 1.0 + (0, 0) = (400, 300)

2) ìƒˆ ìŠ¤ì¼€ì¼: 1.2

3) ì¤Œ í›„ ì›”ë“œ ì¢Œí‘œ (ë³´ì • ì „):
   world_after = (400, 300) / 1.2 + (0, 0) = (333.3, 250)

4) ì›ì  ë³´ì •:
   new_origin = (0, 0) + (400 - 333.3, 300 - 250)
              = (66.7, 50)
```

</details>

---

## ğŸ“Œ í•™ìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] TileKey í•´ì‹œ í•¨ìˆ˜ê°€ ì™œ 31ì„ ê³±í•˜ëŠ”ì§€ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤
- [ ] LRU ìºì‹œì˜ ì‹œê°„ ë³µì¡ë„ê°€ O(1)ì¸ ì´ìœ ë¥¼ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤
- [ ] ë·° í–‰ë ¬ì—ì„œ ì™œ -originì„ ì‚¬ìš©í•˜ëŠ”ì§€ ì´í•´í–ˆë‹¤
- [ ] ì»¤ì„œ ì¤‘ì‹¬ ì¤Œì˜ ì›ì  ë³´ì • ê³µì‹ì„ ìœ ë„í•  ìˆ˜ ìˆë‹¤
- [ ] í”„ë ˆì„ë‹¹ ë‹¤ìš´ë¡œë“œ ì œí•œì´ ì™œ í•„ìš”í•œì§€ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤

---

> **ë‹¤ìŒ ë¬¸ì„œ**: [02_OpenGL_Graphics_Basics.md](#) - ê·¸ë˜í”½ìŠ¤ íŒŒì´í”„ë¼ì¸ ì‹¬í™”
